<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL 저장 디버깅</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>URL 저장 기능 디버깅</h1>
        
        <div class="debug-section">
            <h2>1. 앱 초기화 상태 확인</h2>
            <button onclick="checkAppStatus()" class="btn-primary">앱 상태 확인</button>
            <div id="appStatus"></div>
        </div>
        
        <div class="debug-section">
            <h2>2. 전역 함수 테스트</h2>
            <button onclick="testGlobalFunction()" class="btn-primary">전역 함수 테스트</button>
            <div id="globalTestResult"></div>
        </div>
        
        <div class="debug-section">
            <h2>3. URL 모달 테스트</h2>
            <button onclick="testUrlModal()" class="btn-primary">URL 모달 열기</button>
            <div id="modalTestResult"></div>
        </div>
        
        <div class="debug-section">
            <h2>4. 수동 URL 저장 테스트</h2>
            <input type="text" id="testUrl" placeholder="테스트 URL 입력" value="https://example.com/test">
            <button onclick="testManualSave()" class="btn-primary">수동 저장 테스트</button>
            <div id="manualTestResult"></div>
        </div>
    </div>

    <script type="module">
        import { BibleMeditationApp } from './app/App.js';
        
        // 앱 초기화
        window.app = new BibleMeditationApp();
        
        // 디버깅 함수들
        window.checkAppStatus = function() {
            const statusDiv = document.getElementById('appStatus');
            const status = {
                appExists: !!window.app,
                doctrineModelExists: !!window.app?.doctrineModel,
                doctrinesCount: window.app?.doctrineModel?.getAll()?.length || 0,
                firstDoctrine: window.app?.doctrineModel?.getAll()?.[0] || null
            };
            
            statusDiv.innerHTML = `
                <pre>${JSON.stringify(status, null, 2)}</pre>
            `;
            
            console.log('앱 상태:', status);
        };
        
        window.testGlobalFunction = function() {
            const resultDiv = document.getElementById('globalTestResult');
            
            try {
                // 전역 함수가 존재하는지 확인
                const globalFunctionExists = typeof window.handleDoctrineUrlSave === 'function';
                
                if (globalFunctionExists) {
                    // 테스트 호출
                    window.handleDoctrineUrlSave(1);
                    resultDiv.innerHTML = '<p style="color: green;">✅ 전역 함수 존재 및 호출 성공</p>';
                } else {
                    resultDiv.innerHTML = '<p style="color: red;">❌ 전역 함수가 존재하지 않음</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ 오류 발생: ${error.message}</p>`;
            }
        };
        
        window.testUrlModal = function() {
            const resultDiv = document.getElementById('modalTestResult');
            
            try {
                const firstDoctrine = window.app.doctrineModel.getAll()[0];
                if (firstDoctrine) {
                    window.app.showDoctrineUrlModal(firstDoctrine.id);
                    resultDiv.innerHTML = '<p style="color: green;">✅ URL 모달 열기 성공</p>';
                } else {
                    resultDiv.innerHTML = '<p style="color: red;">❌ 테스트할 교리가 없음</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ 오류 발생: ${error.message}</p>`;
            }
        };
        
        window.testManualSave = function() {
            const resultDiv = document.getElementById('manualTestResult');
            const testUrl = document.getElementById('testUrl').value;
            
            try {
                const firstDoctrine = window.app.doctrineModel.getAll()[0];
                if (firstDoctrine && testUrl) {
                    const success = window.app.doctrineModel.saveDoctrineUrl(firstDoctrine.id, testUrl);
                    if (success) {
                        resultDiv.innerHTML = '<p style="color: green;">✅ 수동 저장 성공</p>';
                    } else {
                        resultDiv.innerHTML = '<p style="color: orange;">⚠️ 저장 실패 (중복 URL일 수 있음)</p>';
                    }
                } else {
                    resultDiv.innerHTML = '<p style="color: red;">❌ 교리 또는 URL이 없음</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ 오류 발생: ${error.message}</p>`;
            }
        };
        
        console.log('디버깅 페이지 로드됨');
        console.log('window.app:', window.app);
        console.log('window.handleDoctrineUrlSave:', window.handleDoctrineUrlSave);
    </script>
</body>
</html> 