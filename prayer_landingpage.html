<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ï§ëÎ≥¥Í∏∞ÎèÑÌöå Í¥ëÍ≥†</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #FFFFFF;
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      transition: all 1s ease;
      padding-top: 60px;
    }
    #slide {
      width: 90%;
      max-width: 1600px;
      margin-bottom: 20px;
      white-space: pre-line;
      padding: 20px;
      font-size: clamp(1.5rem, 5vw, 4rem);
      transition: all 1s ease;
      line-height: 1.5;
      font-weight: 600;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .control-panel {
      position: fixed;
      bottom: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.2);
      padding: 15px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    .btn {
      padding: 12px 24px;
      font-size: clamp(0.8rem, 2vw, 1.2rem);
      cursor: pointer;
      background-color: rgba(255, 255, 255, 0.25);
      color: inherit;
      border: none;
      border-radius: 10px;
      transition: all 0.3s ease;
      font-weight: 500;
      backdrop-filter: blur(5px);
    }
    .btn:hover {
      background-color: rgba(255, 255, 255, 0.4);
      transform: translateY(-2px);
    }
    #fullscreenButton {
      background-color: rgba(255, 255, 255, 0.25);
    }
    #fullscreenButton:hover {
      background-color: rgba(255, 255, 255, 0.4);
    }
    #colorPicker {
      width: 50px;
      height: 40px;
      padding: 0;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .hide-controls .control-panel {
      opacity: 0;
      transition: opacity 0.3s;
    }
    .hide-controls .control-panel:hover {
      opacity: 1;
    }
    .qr-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 1001;
    }
    .qr-modal img {
      max-width: 300px;
      height: auto;
    }
    .qr-modal .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 24px;
    }
    @media (orientation: portrait) {
      #slide {
        width: 95%;
        font-size: clamp(1.2rem, 7vw, 3rem);
      }
    }
    @media (min-width: 2560px) {
      #slide {
        max-width: 2000px;
        font-size: clamp(2rem, 4vw, 5rem);
      }
    }
    /* ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Ïä§ÌÉÄÏùº */
    .nav-container {
      position: fixed;
      top: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      z-index: 1000;
      padding: 10px 0;
    }

    .nav-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .nav-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .ad-section {
      position: fixed;
      top: 60px;
      right: 20px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 15px;
      border-radius: 10px;
      max-width: 300px;
      z-index: 999;
    }

    .music-player {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .music-controls {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .music-info {
      font-size: 0.9rem;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <nav class="nav-container">
    <div class="nav-content">
      <div class="nav-title">Ï§ëÎ≥¥Í∏∞ÎèÑÌöå</div>
      <div class="music-player">
        <div class="music-controls">
          <button id="musicButton" class="btn" onclick="toggleMusic()">üîà Ïû¨ÏÉù</button>
          <span id="musicTime" class="music-info">00:00 / 00:00</span>
        </div>
      </div>
    </div>
  </nav>

  <div class="ad-section" id="adSection">
    <h3>Í≥µÏßÄÏÇ¨Ìï≠</h3>
    <div id="adContent"></div>
  </div>

  <div id="slide"></div>
  <div class="control-panel">
    <button id="fullscreenButton" class="btn">Ï†ÑÏ≤¥ÌôîÎ©¥</button>
    <button id="themeButton" class="btn">ÌÖåÎßà Î≥ÄÍ≤Ω</button>
    <button id="googleSlideButton" class="btn">Íµ¨Í∏Ä Ïä¨ÎùºÏù¥Îìú</button>
    <button id="qrButton" class="btn">QR ÏΩîÎìú</button>
  </div>

  <div id="qrModal" class="qr-modal">
    <span class="close-btn">&times;</span>
    <div id="qrCode"></div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    // ÏÑ§Ï†ïÍ∞í
    const GOOGLE_SLIDE_URL = "https://docs.google.com/presentation/u/0/";
    const QR_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSfvbtqWGPS2iVopJH9t75bPREoa8suUrbiLivdOjCxTPiRO3g/viewform";
    const BACKGROUND_MUSIC_URL = "/Celestial Whisper.mp3";

    // ÌëúÏãúÌï† Î¨∏Íµ¨(Í∏∞ÎèÑÏ†úÎ™©, ÎßêÏîÄ, Í¥ëÍ≥†Î¨∏Íµ¨)Îì§ÏùÑ Ïä¨ÎùºÏù¥Îìú ÌòïÏãùÏúºÎ°ú Îã¥ÏùÄ Î∞∞Ïó¥
    const slides = [
      "ÏïàÏãùÏùº ÎßêÏîÄ Î¨µÏÉÅÍ∏∞ÎèÑ & \n\nÏ§ëÎ≥¥Í∏∞ÎèÑ Ï†úÎ™©ÏùÑ ÎÇòÎàïÎãàÎã§.",
      "ÏûêÏú†Î°≠Í≤å Í∏∞ÎèÑÏóê Ï∞∏Í∞ÄÌïòÏÑ∏Ïöî!",
      "(Ï§ëÎ≥¥Í∏∞ÎèÑ 1)\n\n4Ïõî 19Ïùº Í∞ÄÏ°± ÏπúÏßÄ ÏÑ†ÍµêÏùò ÎÇ† Î∂ÄÌù•ÏùÑ ÏúÑÌïú Í∏∞ÎèÑ",
      "(Ï§ëÎ≥¥Í∏∞ÎèÑ 2)\n\n12Í∏∞ Ïπ®Î°ÄÏûêÎì§ÏùÑ ÏúÑÌïú Ï§ëÎ≥¥Í∏∞ÎèÑ ÎìúÎ¶ΩÎãàÎã§",
      "(Ï§ëÎ≥¥Í∏∞ÎèÑ 3)\n\nÍµêÏö∞Îì§Ïùò Í∞ÄÏ†ïÎßàÎã§ ÏÑ±Î†πÏùò Ïù∏ÎèÑÌïòÏã¨ÏùÑ Í∏∞ÎèÑ ÎìúÎ¶ΩÎãàÎã§",
      "ÏÑ±Í≤Ω ÎßêÏîÄ: Îç∞ÏÇ¥Î°úÎãàÍ∞ÄÏ†ÑÏÑú 5Ïû• 17Ï†à\n\n'Ïâ¨ÏßÄ ÎßêÍ≥† Í∏∞ÎèÑÌïòÎùº'",
      "ÏÑ±Í≤Ω ÎßêÏîÄ: ÎπåÎ¶ΩÎ≥¥ÏÑú 4Ïû• 6Ï†à\n\n'ÏïÑÎ¨¥ Í≤ÉÎèÑ ÏóºÎ†§ÌïòÏßÄ ÎßêÍ≥† Îã§Îßå Î™®Îì† ÏùºÏóê Í∏∞ÎèÑÏôÄ Í∞ÑÍµ¨Î°ú...'",
      "ÏÑ±Í≤Ω ÎßêÏîÄ: ÎßàÌÉúÎ≥µÏùå 7Ïû• 7Ï†à\n\n'Íµ¨ÌïòÎùº Í∑∏Î¶¨ÌïòÎ©¥ ÎÑàÌù¨ÏóêÍ≤å Ï£ºÏã§ Í≤ÉÏù¥Ïöî\n\nÏ∞æÏúºÎùº Í∑∏Î¶¨ÌïòÎ©¥ Ï∞æÏùÑ Í≤ÉÏù¥Ïöî...'",
      "Ìï®Íªò ÌïòÎäî Í∏∞ÎèÑ ÏãúÍ∞Ñ\n\nÏ£ºÎãòÍ≥ºÏùò ÍπäÏùÄ ÍµêÏ†úÏóê Ï¥àÎåÄÌï©ÎãàÎã§."
    ];

    // ÏÉâÏÉÅ ÌÖåÎßà Ï†ïÏùò
    const colorThemes = [
      { bg: '#1a1a1a', text: '#ffffff', name: 'Îã§ÌÅ¨' },
      { bg: '#f0f0f0', text: '#2c3e50', name: 'ÎùºÏù¥Ìä∏' },
      { bg: '#2c3e50', text: '#ecf0f1', name: 'ÎØ∏ÎìúÎÇòÏûá' },
      { bg: '#f1c40f', text: '#2c3e50', name: 'ÏÑ†ÏÉ§Ïù∏' },
      { bg: '#27ae60', text: '#ffffff', name: 'Ìè¨Î†àÏä§Ìä∏' },
      { bg: '#8e44ad', text: '#ffffff', name: 'ÎØ∏Ïä§Ìã±' },
      { bg: '#2980b9', text: '#ffffff', name: 'Ïò§ÏÖò' },
      { bg: '#c0392b', text: '#ffffff', name: 'Î£®ÎπÑ' },
      { bg: '#2c3e50', text: '#f1c40f', name: 'Í≥®Îìú' },
      { bg: '#16a085', text: '#ffffff', name: 'ÏóêÎ©îÎûÑÎìú' }
    ];

    let currentThemeIndex = 0;
    let currentIndex = 0;
    let isPlaying = true;
    let intervalId = null;
    let audio = null;
    let isMusicPlaying = false;
    let musicButton = null;

    const displayElement = document.getElementById("slide");
    const fullscreenButton = document.getElementById("fullscreenButton");
    const themeButton = document.getElementById("themeButton");
    const googleSlideButton = document.getElementById("googleSlideButton");
    const qrButton = document.getElementById("qrButton");
    const qrModal = document.getElementById("qrModal");
    
    // QR ÏΩîÎìú Ï¥àÍ∏∞Ìôî
    const qrCode = new QRCode(document.getElementById("qrCode"), {
      text: QR_FORM_URL,
      width: 256,
      height: 256,
      colorDark: "#000000",
      colorLight: "#ffffff",
      correctLevel: QRCode.CorrectLevel.H
    });

    // Í¥ëÍ≥† ÎÇ¥Ïö© Î∞∞Ïó¥
    const advertisements = [
      "4Ïõî 19Ïùº Í∞ÄÏ°± ÏπúÏßÄ ÏÑ†ÍµêÏùò ÎÇ†",
      "5Ïõî 23-25 ÏïàÎ©¥ÎèÑ Ïû¨Î¶º Ïó∞ÏàòÏõê 12Í∏∞ Ïπ®Î°ÄÏãù ",
      "8Ïõî Ïû•ÎßâÏßëÌöå",
      "ÏÑ†ÍµêÎ∂Ä ÎØ∏ÌåÖ Îß§Ï£º ÏïàÏãùÏùº Ïò§ÌõÑ 3ÏãúÎ∂ÄÌÑ∞"
    ];

    let currentAdIndex = 0;
    const adContent = document.getElementById("adContent");

    // Í¥ëÍ≥† ÏàúÌôò Ìï®Ïàò
    function rotateAd() {
      adContent.textContent = advertisements[currentAdIndex];
      currentAdIndex = (currentAdIndex + 1) % advertisements.length;
    }

    // ÏùåÏïÖ Ï¥àÍ∏∞Ìôî Ìï®Ïàò Í∞úÏÑ†
    async function initAudio() {
      try {
        console.log('Initializing audio...');
        if (!audio) {
          audio = new Audio();
          audio.preload = 'auto';
          audio.loop = true;
          
          // Ïò§ÎîîÏò§ ÏÜåÏä§ ÏÑ§Ï†ï Ï†ÑÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
          audio.addEventListener('canplaythrough', () => {
            console.log('Audio can play through');
          });
          
          // Ïò§ÎîîÏò§ ÏÜåÏä§ ÏÑ§Ï†ï
          audio.src = BACKGROUND_MUSIC_URL;
          
          // Ïò§ÎîîÏò§ Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Î°úÎìú ÎåÄÍ∏∞
          await new Promise((resolve, reject) => {
            audio.addEventListener('loadedmetadata', () => {
              console.log('Audio metadata loaded');
              resolve();
            });
            
            audio.addEventListener('error', (e) => {
              console.error('Audio load error:', e);
              console.error('Error code:', audio.error ? audio.error.code : 'unknown');
              reject(e);
            });
            
            // 5Ï¥à ÌõÑÏóêÎèÑ Î°úÎìúÎêòÏßÄ ÏïäÏúºÎ©¥ ÌÉÄÏûÑÏïÑÏõÉ
            setTimeout(() => {
              reject(new Error('Audio load timeout'));
            }, 5000);
          });
          
          audio.addEventListener('timeupdate', updateMusicTime);
          audio.addEventListener('ended', () => {
            console.log('Audio ended');
            audio.currentTime = 0;
            if (isMusicPlaying) {
              audio.play().catch(handlePlayError);
            }
          });
          
          audio.addEventListener('play', () => {
            console.log('Audio started playing');
          });
          
          audio.addEventListener('pause', () => {
            console.log('Audio paused');
          });
        }
        return true;
      } catch (error) {
        console.error('Audio initialization failed:', error);
        handlePlayError(error);
        return false;
      }
    }

    // Ïû¨ÏÉù ÏóêÎü¨ Ï≤òÎ¶¨ Ìï®Ïàò Í∞úÏÑ†
    function handlePlayError(error) {
      console.error('Playback error:', error);
      console.error('Audio state:', {
        readyState: audio ? audio.readyState : 'no audio',
        paused: audio ? audio.paused : 'no audio',
        currentSrc: audio ? audio.currentSrc : 'no audio',
        error: audio && audio.error ? audio.error.code : 'no error'
      });
      
      isMusicPlaying = false;
      if (!musicButton) {
        musicButton = document.getElementById("musicButton");
      }
      musicButton.textContent = "üîá Ïò§Î•ò";
      document.getElementById("musicTime").textContent = "ÏùåÏïÖ Î°úÎìú Ïã§Ìå®";
    }

    // ÏùåÏïÖ Ïû¨ÏÉù/Ï†ïÏßÄ ÌÜ†Í∏Ä Í∞úÏÑ†
    async function toggleMusic() {
      if (!musicButton) {
        musicButton = document.getElementById("musicButton");
      }

      try {
        console.log('Toggle music called. Current state:', isMusicPlaying);
        
        if (!audio) {
          console.log('Initializing audio for the first time');
          const initialized = await initAudio();
          if (!initialized) {
            throw new Error('Audio initialization failed');
          }
        }

        if (isMusicPlaying) {
          console.log('Attempting to pause audio');
          audio.pause();
          musicButton.textContent = "üîà Ïû¨ÏÉù";
          isMusicPlaying = false;
        } else {
          console.log('Attempting to play audio');
          try {
            // Ïò§ÎîîÏò§ Î°úÎìú ÏÉÅÌÉú ÌôïÏù∏
            if (audio.readyState < 2) { // HAVE_CURRENT_DATA
              console.log('Audio not ready, waiting for data...');
              await new Promise((resolve, reject) => {
                audio.addEventListener('canplay', resolve, { once: true });
                audio.addEventListener('error', reject, { once: true });
                // 3Ï¥à ÌÉÄÏûÑÏïÑÏõÉ
                setTimeout(() => reject(new Error('Audio load timeout')), 3000);
              });
            }
            
            const playPromise = audio.play();
            if (playPromise !== undefined) {
              await playPromise;
              console.log('Audio playing successfully');
              musicButton.textContent = "‚è∏Ô∏è Ï†ïÏßÄ";
              isMusicPlaying = true;
            }
          } catch (playError) {
            console.error('Play attempt failed:', playError);
            throw playError;
          }
        }
      } catch (error) {
        handlePlayError(error);
      }
    }

    // ÏùåÏïÖ ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò Í∞úÏÑ†
    function updateMusicTime() {
      if (!audio || audio.paused) return;
      
      try {
        const current = Math.floor(audio.currentTime);
        const duration = Math.floor(audio.duration);
        const currentMin = Math.floor(current / 60);
        const currentSec = current % 60;
        const durationMin = Math.floor(duration / 60);
        const durationSec = duration % 60;
        
        const timeElement = document.getElementById("musicTime");
        if (timeElement) {
          timeElement.textContent = 
            `${currentMin}:${currentSec.toString().padStart(2, '0')} / ${durationMin}:${durationSec.toString().padStart(2, '0')}`;
        }
      } catch (error) {
        console.error('Error updating music time:', error);
      }
    }

    // QR Î™®Îã¨ ÌëúÏãú/Ïà®ÍπÄ
    function toggleQRModal() {
      const isVisible = qrModal.style.display === "block";
      qrModal.style.display = isVisible ? "none" : "block";
    }

    // Íµ¨Í∏Ä Ïä¨ÎùºÏù¥Îìú Ïó¥Í∏∞
    function openGoogleSlide() {
      window.open(GOOGLE_SLIDE_URL, '_blank');
    }
    
    // ÌÖåÎßà Î≥ÄÍ≤Ω Ìï®Ïàò
    function changeTheme(index) {
      const theme = colorThemes[index];
      document.body.style.backgroundColor = theme.bg;
      document.body.style.color = theme.text;
      themeButton.textContent = `ÌÖåÎßà: ${theme.name}`;
    }

    // Îã§Ïùå ÌÖåÎßàÎ°ú Î≥ÄÍ≤Ω
    function nextTheme() {
      currentThemeIndex = (currentThemeIndex + 1) % colorThemes.length;
      changeTheme(currentThemeIndex);
    }

    // ÏûêÎèô ÌÖåÎßà Î≥ÄÍ≤Ω
    function startThemeChange() {
      return setInterval(() => {
        nextTheme();
      }, 30000); // 30Ï¥àÎßàÎã§ ÌÖåÎßà Î≥ÄÍ≤Ω
    }

    // Ïä¨ÎùºÏù¥Îìú ÌëúÏãú Ìï®Ïàò
    function showSlide(index) {
      displayElement.textContent = slides[index];
      optimizeFontSize();
    }
    
    // Îã§Ïùå Ïä¨ÎùºÏù¥ÎìúÎ°ú Ï†ÑÌôò
    function nextSlide() {
      currentIndex = (currentIndex + 1) % slides.length;
      showSlide(currentIndex);
    }
    
    // Ï†ÑÏ≤¥ÌôîÎ©¥ ÌÜ†Í∏Ä Ìï®Ïàò
    function toggleFullScreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().then(() => {
          document.body.classList.add('hide-controls');
          fullscreenButton.textContent = "Ï†ÑÏ≤¥ÌôîÎ©¥ Ï¢ÖÎ£å";
        });
      } else {
        document.exitFullscreen().then(() => {
          document.body.classList.remove('hide-controls');
          fullscreenButton.textContent = "Ï†ÑÏ≤¥ÌôîÎ©¥";
        });
      }
      setTimeout(optimizeFontSize, 100);
    }
    
    // ÌôîÎ©¥ ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Ïãú Í∏ÄÏûê ÌÅ¨Í∏∞ ÏµúÏ†ÅÌôî
    function optimizeFontSize() {
      const slide = document.getElementById('slide');
      const contentLength = slide.textContent.length;
      
      if (contentLength > 100) {
        slide.style.fontSize = 'clamp(1rem, 4vw, 3rem)';
      } else if (contentLength > 50) {
        slide.style.fontSize = 'clamp(1.2rem, 4.5vw, 3.5rem)';
      } else {
        slide.style.fontSize = 'clamp(1.5rem, 5vw, 4rem)';
      }
    }

    // Ï¥àÍ∏∞ ÏÑ§Ï†ï
    showSlide(currentIndex);
    changeTheme(currentThemeIndex);
    intervalId = setInterval(nextSlide, 10000);
    const themeIntervalId = startThemeChange();
    
    // Í¥ëÍ≥† ÏàúÌôò Ï∂îÍ∞Ä
    rotateAd();
    setInterval(rotateAd, 5000); // 5Ï¥àÎßàÎã§ Í¥ëÍ≥† Î≥ÄÍ≤Ω

    // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
    fullscreenButton.addEventListener("click", toggleFullScreen);
    themeButton.addEventListener("click", nextTheme);
    googleSlideButton.addEventListener("click", openGoogleSlide);
    qrButton.addEventListener("click", toggleQRModal);
    document.querySelector(".close-btn").addEventListener("click", toggleQRModal);
    window.addEventListener('resize', optimizeFontSize);

    // Ï†ÑÏ≤¥ÌôîÎ©¥ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏
    document.addEventListener('fullscreenchange', () => {
      if (!document.fullscreenElement) {
        document.body.classList.remove('hide-controls');
        fullscreenButton.textContent = "Ï†ÑÏ≤¥ÌôîÎ©¥";
      } else {
        document.body.classList.add('hide-controls');
        fullscreenButton.textContent = "Ï†ÑÏ≤¥ÌôîÎ©¥ Ï¢ÖÎ£å";
      }
      setTimeout(optimizeFontSize, 100);
    });

    // Î∂ÄÎ™® Ï∞ΩÏóêÏÑú Ïò§Îäî Î©îÏãúÏßÄ ÏàòÏã† Í∞úÏÑ†
    window.addEventListener('message', async function(event) {
      if (event.data.type === 'TOGGLE_MUSIC') {
        if (!audio) {
          await initAudio();
        }
        if (event.data.playing) {
          audio.play().catch(handlePlayError);
        } else {
          audio.pause();
        }
        isMusicPlaying = event.data.playing;
      } else if (event.data.type === 'GET_MUSIC_STATE') {
        window.parent.postMessage({
          type: 'MUSIC_STATE',
          playing: isMusicPlaying
        }, '*');
      }
    });
  </script>
</body>
</html>
